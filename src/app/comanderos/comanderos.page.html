<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Gestionar Comanderos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-card color="light">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="settings-outline" slot="start"></ion-icon>
              Configuración de Admin
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item lines="none">
              <ion-label position="floating">Impresora General (QR e Historial)</ion-label>
              <ion-input [(ngModel)]="adminPrinterName" placeholder="p.ej. Impresora_Oficina"></ion-input>
            </ion-item>
            <ion-button expand="block" fill="outline" color="primary" (click)="guardarAdminPrinter()">
              <ion-icon name="save-outline" slot="start"></ion-icon>
              Guardar Impresora Admin
            </ion-button>
            <p style="font-size: 0.8em; color: #666; margin-top: 10px;">
              Esta impresora se usará para imprimir códigos QR y resúmenes del historial.
            </p>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Añadir Comandero</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label position="floating">Número (ej: 1)</ion-label>
              <ion-input type="number" [(ngModel)]="nuevoNumero"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Descripción (ej: Barra)</ion-label>
              <ion-input [(ngModel)]="nuevaDescripcion"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Nombre de Impresora (QZ Tray)</ion-label>
              <ion-input [(ngModel)]="nuevaImpresora" placeholder="p.ej. EPSON-T20"></ion-input>
            </ion-item>
            <ion-button expand="block" (click)="agregarComandero()" [disabled]="!nuevoNumero || !nuevaDescripcion">
              <ion-icon name="add" slot="start"></ion-icon>
              Añadir
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-list>
          <ion-item *ngFor="let comandero of comanderos$ | async">
            <ng-container *ngIf="editando !== comandero.id; else editMode">
              <ion-label>
                <h2>{{ comandero.descripcion }}</h2>
                <p>Número: {{ comandero.numero }} | Impresora: {{ comandero.printerName || 'Predet.' }}</p>
              </ion-label>
              <ion-buttons slot="end">
                <ion-button color="tertiary" (click)="iniciarEdicion(comandero)">
                  <ion-icon name="create-outline"></ion-icon>
                </ion-button>
                <ion-button color="danger" (click)="eliminarComandero(comandero.id)">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ng-container>
            
            <ng-template #editMode>
               <ion-grid style="width: 100%; padding:0;">
                 <ion-row>
                   <ion-col size="2">
                     <ion-input type="number" [(ngModel)]="editNumero" placeholder="N"></ion-input>
                   </ion-col>
                   <ion-col size="3">
                     <ion-input [(ngModel)]="editDescripcion" placeholder="Desc"></ion-input>
                   </ion-col>
                   <ion-col size="4">
                     <ion-input [(ngModel)]="editImpresora" placeholder="Impr"></ion-input>
                   </ion-col>
                   <ion-col size="3" style="display:flex; justify-content: flex-end;">
                     <ion-button size="small" color="success" (click)="guardarEdicion()">
                       <ion-icon name="checkmark"></ion-icon>
                     </ion-button>
                     <ion-button size="small" color="medium" (click)="cancelarEdicion()">
                       <ion-icon name="close"></ion-icon>
                     </ion-button>
                   </ion-col>
                 </ion-row>
               </ion-grid>
            </ng-template>
          </ion-item>
        </ion-list>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
